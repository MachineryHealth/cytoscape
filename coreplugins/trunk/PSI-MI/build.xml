<?xml version="1.0"?>
<!-- build.xml - Build file for Cytoscape PSI-MI Plug In -->
<project  default="all" name="Cytoscape PSI-MI PlugIn">
    <!-- Version Numbers -->
    <property name="psi_mi_version" value="0_3"/>
    <!--  Define Check Style Task -->
    <taskdef resource="checkstyletask.properties"/>
    <!-- The directory containing source code -->
    <property name="src.dir" value="src"/>
    <!-- The directory containing the configuration files -->
    <property name="config.dir" value="config"/>
    <!-- Temporary build directories -->
    <property name="build.dir" value="build"/>
    <property name="build.classes" value="${build.dir}/classes"/>
    <!-- Jars directory -->
    <property name="jars.dir" value="${build.dir}/jars"/>
    <!-- PlugIns directory -->
    <property name="plugins.dir" value="plugins"/>
    <!-- Global "magic" property for <javac> -->
    <property name="build.compiler" value="modern"/>
    <!-- Junit Directory -->
    <property name="junit.dir" value="${build.dir}/junit"/>

    <!-- Classpath with all lib JAR Files -->
    <path id="classpath">
        <pathelement path="${build.classes}"/>
        <fileset dir="../../cytoscape/lib">
                <include name="*.jar"/>
        </fileset>
        <fileset dir="../../cytoscape/">
                <include name="cytoscape.jar"/>
        </fileset>
        <fileset dir="lib">
                <include name="*.jar"/>
        </fileset>
    </path>

    <!-- Target to create the build directories prior to compilation -->
    <target name="prepare">
        <mkdir dir="${build.dir}"/>
        <mkdir dir="${build.classes}"/>
        <mkdir dir="${jars.dir}"/>
    </target>

    <!--  Target to clean out all directories -->
    <target description="Removes all generated files." name="clean">
        <delete dir="${build.dir}"/>
        <delete dir="${jars.dir}"/>
        <delete dir="${plugins.dir}"/>
        <delete dir="${junit.dir}"/>
    </target>

    <!--  Target to compile all code -->
    <target depends="prepare" description="Compiles all source code."
        name="compile">
        <javac debug="true" debuglevel="source,lines,var"
            destdir="${build.classes}" nowarn="on" srcdir="${src.dir}" deprecation="false">
            <classpath refid="classpath"/>
        </javac>
    </target>

    <!--  Target to Run Cytoscape -->
    <target depends="jar" description="Runs Cytoscape." name="run">
        <copy todir="${plugins.dir}">
            <fileset dir="${jars.dir}"/>
        </copy>
        <java classname="cytoscape.CyMain" classpathref="classpath"
            fork="true" maxmemory="1000M">
            <arg line="-p plugins"/>
        </java>
    </target>

    <!--  Target to Run CheckStyle on all Source Code -->
    <!--  Uses the Sun Coding Conventions Configuration -->
    <target description="Checks Sun Coding Conventions" name="check">
        <checkstyle config="${config.dir}/sun_checks.xml">
            <fileset dir="${src.dir}/org">
                <include name="**/*.java"/>
            </fileset>
        </checkstyle>
    </target>

    <!--  Target to Run All JUnit Tests -->
    <target depends="compile" description="Runs all JUnit Tests" name="test">
        <delete dir="${junit.dir}"/>
        <mkdir dir="${junit.dir}"/>
        <mkdir dir="${junit.dir}/reports"/>
        <junit printsummary="yes" fork="yes" haltonfailure="yes" dir="${basedir}">
            <formatter type="plain" usefile="false"/>
            <test name="org.cytoscape.coreplugin.psi_mi.test.AllTest"/>
            <classpath refid="classpath"/>
        </junit>
    </target>

    <!--  Target to Create PlugIn JAR -->
    <target depends="compile" description="Creates PlugIn JAR" name="jar">

        <!-- Start clean -->
        <delete dir="${jars.dir}"/>
        <mkdir dir="${jars.dir}"/>

        <!--  Create BioPAX Jar -->
        <jar destfile="${jars.dir}/psi_mi_${psi_mi_version}.jar">
            <fileset dir="${build.classes}">
            </fileset>
        </jar>
    </target>

    <!--  Builds and tests everything -->
    <target depends="jar,test" description="Builds and tests everything" name="all"/>
</project>
