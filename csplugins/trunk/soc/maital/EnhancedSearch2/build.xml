<?xml version="1.0"?>
<!--
	Enhanced Search Ant Build Script.
	Author:  Maital Ashkenazi
-->

<project name="EnhancedSearch" default="all" basedir="." xmlns:artifact="antlib:org.apache.maven.artifact.ant">

	<!-- =================================================================== -->
	<!-- Initialization target                                               -->
	<!-- =================================================================== -->
	<target name="init">
		<tstamp />
		<property name="name" value="EnhancedSearch" />
		<property name="version" value="1.2" />

		<echo message="Building ${name} version ${version} ..." />

		<!-- Inheritable properties -->
		<property name="debug" value="on" />
		<property name="optimize" value="off" />
		<property name="deprecation" value="on" />
		<property name="fork" value="false" />

		<!-- Define the directories -->
		<property name="root.dir" value="." />
		<property name="resources.dir" value="${root.dir}/resources" />
		<property name="src.dir" value="${root.dir}/src" />
		<property name="build.dir" value="${root.dir}/build" />
		<property name="lib.dir" value="${root.dir}/lib" />
		<property name="log.dir" value="${build.dir}/logs" />
		<property name="cytoscape.dir" value="../cytoscape" />
		<property name="junit.report.dir" value="${log.dir}/junit-reports" />

		<!-- Define the relevant files -->
		<property name="project.jar" value="${name}.jar" />

		<!-- Define the class path -->
		<path id="project.class.path">
			<fileset dir="/usr/share/ant/lib">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${lib.dir}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${cytoscape.dir}">
				<include name="*.jar" />
			</fileset>
		</path>

		<!-- Define the junit class path - It needs to find what we just built -->
		<path id="junit.class.path">
			<fileset dir="/usr/share/ant/lib">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${root.dir}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${lib.dir}">
				<include name="*.jar" />
			</fileset>
			<fileset dir="${cytoscape.dir}">
				<include name="*.jar" />
			</fileset>
		</path>

	</target>

	<!-- =================================================================== -->
	<!-- Compiles the project                                                -->
	<!-- =================================================================== -->
	<target name="compile" depends="init">
		<mkdir dir="${build.dir}" />
		<mkdir dir="${log.dir}" />
		<javac srcdir="${src.dir}" classpathref="project.class.path" destdir="${build.dir}" debug="${debug}" deprecation="${deprecation}" compiler="javac1.5" optimize="${optimize}" fork="${fork}">
		       <compilerarg line="-Xlint:unchecked"/>
		</javac>
		<echo message="Successfully ran compile task!" />
	</target>


	<!-- =================================================================== -->
	<!-- Creates the project jar file                                        -->
	<!-- =================================================================== -->
	<target name="jar" depends="compile">

	   <copy todir="build/csplugins/enhanced/search/" file="resources/plugin.props"/>
		<unjar dest="${build.dir}">
			<fileset dir="${lib.dir}">
				<include name="*.jar" />
			</fileset>
		</unjar>

		<jar destfile="${project.jar}">
			<fileset dir="${build.dir}" includes="**" />
			<manifest>
				<attribute name="Cytoscape-Plugin" value="csplugins.enhanced.search.EnhancedSearchPlugin" />
			</manifest>
		</jar>
		<echo message="Successfully ran jar task!" />
	</target>


    <!-- ==================== Run Target ================================= -->
    <target description="Runs Latest Version of Cytoscape with EnhancedSearch Plugin"
        name="run">
        <java classname="cytoscape.CyMain" classpathref="project.class.path"
            fork="true" maxmemory="1000M">
            <arg line="-p ${root.dir}"/>
        </java>
    </target>



	<!-- ==================== JUnit Test Target =========================== -->
	<target name="test" description="Runs all JUnit tests" depends="compile">
		<junit printsummary="yes" fork="yes" haltonfailure="yes">
			<formatter type="plain" usefile="false" />
			<test name="csplugins.enhanced.search.TestEnhancedSearch" />
			<classpath refid="junit.class.path" />
		</junit>
	</target>

	<!-- =================================================================== -->
	<!-- Do everything                                                       -->
	<!-- =================================================================== -->
	<target name="all" depends="clean,compile,jar,test" />

	<!-- =================================================================== -->
	<!-- Clean up, get back to original state                                -->
	<!-- =================================================================== -->
	<target name="clean" depends="init">
		<delete dir="${build.dir}" />
		<delete dir="${javadoc.dir}" />
		<delete file="${project.jar}" />
		<delete file="${test.jar}" />
		<echo message="Successfully ran clean task!" />
	</target>

</project>

