<?xml version = "1.0"?>
<!--
=====================================================================
              A N T   B U I L D   F I L E
=====================================================================
  Project      : Cytoscape ChemInfo Plugin
  Author       : Dazhi Jiao dazhi.jiao@gmail.com
  Version      : $Revision: $ $Date: $
=====================================================================
-->
<project name="ChemInfoPlugin" default="jar" basedir=".">
  <property name="src.dir" location="${basedir}/src" />
  <property name="build.dir" location="build" />
  <property name="doc.dir" location="doc" />
  <property name="test.dir" location="testData" />
  <property name="cytoscape.dir" location="../../../../cytoscape" />
  <property name="cytoscape.plugin" value="${cytoscape.dir}/plugins" />

  <!-- Compilation Parameters -->
  <property name="compile.debug" value="true" />
  <property name="compile.deprecation" value="true" />
  <property name="compile.optimize" value="true" />

  <!-- Classpaths -->
  <path id="compile.classpath">
    <pathelement path="${build.dir}/classes" />
    <fileset dir="${cytoscape.dir}/lib">
      <include name="*.jar" />
    </fileset>
    <fileset dir="${cytoscape.dir}">
      <include name="cytoscape.jar" />
    </fileset>
  </path>

  <!--
  =====================================================================
    I N I T
  =====================================================================
    Preparing for compile
  =====================================================================
  -->
  <target name="init" depends="clean" description="Preparing for building">
    <mkdir dir="${build.dir}" />
    <mkdir dir="${build.dir}/classes" />
  </target>

  <!--
  =====================================================================
    C O M P I L E
  =====================================================================
    Compile with Cytoscape under deveopment
  =====================================================================
  -->  
  <target name="compile" depends="init" description="Compile with Cytoscape under development">
    <javac source="1.5" debug="${compile.debug}" deprecation="${compile.deprecation}" optimize="${compile.optimize}" srcdir="${src.dir}" destdir="${build.dir}/classes">
      <classpath refid="compile.classpath" />
    </javac>
  </target>

  <!--
  =====================================================================
    C L E A N
  =====================================================================
    Removes the built and distrabution files
  =====================================================================
  -->  
  <target name="clean" description="clean up">
    <!-- Delete the ${build} and ${src} directory trees -->
    <delete dir="${build.dir}" />
  </target>

  <!--
  =====================================================================
    J A R
  =====================================================================
    Build jar files for distribution
  =====================================================================
  -->  
  <target name="jar" depends="compile" description="makes a jar for Cytoscape under development">
    <copy todir="build/classes/cytoscape/plugin/cheminfo">
      <fileset file="${src.dir}/cytoscape/plugin/cheminfo/*.props" />
    </copy>
    <jar jarfile="${build.dir}/cheminfo.jar">
      <manifest>
        <attribute name="Cytoscape-Plugin" value="cytoscape.plugin.cheminfo.ChemInfoPlugin" />
      </manifest>
      <fileset dir="${build.dir}/classes" />
    </jar>
  </target>

  <!--
  =====================================================================
    R U N
  =====================================================================
    Run cytoscape with the plugin
  =====================================================================
  -->    
  <target name="run" depends="jar" description="Run under development">
    <copy todir="${cytoscape.dir}/plugins/core">
      <fileset file="${basedir}/build/cheminfo.jar" />
    </copy>
    <java classname="cytoscape.CyMain" classpathref="compile.classpath" fork="true" maxmemory="1g">
      <arg value="-s"/>
      <arg value="${test.dir}/cheminfoTest.cys"/>
      <arg value="-p"/> 
      <arg value="${cytoscape.dir}/plugins/core" />
    </java>
  </target>
</project>