<?xml version="1.0"?>

<project name="cytoscape.task" default="compile" basedir=".">
  <property name="src.dir" value="${basedir}/src"/>
  <property name="lib.dir" value="${basedir}/lib"/>
  <property name="build.dir" value="${basedir}/build"/>
  <property name="javadoc.dir" value="${build.dir}/API-doc"/>
  <property name="temp.src.dir" value="${build.dir}/tempsrc"/>
  <property name="classes.dir" value="${build.dir}/classes"/>
  <property name="little.jars.dir" value="${build.dir}/littlejars"/>
  <property name="config.dir" value="config"/>

  <!--  Define Check Style Task -->
  <taskdef resource="checkstyletask.properties"/>

  <target name="clean">
    <delete dir="${build.dir}"/>
  </target>

  <!-- Classpath with all lib JAR Files -->
  <path id="classpath">
    <pathelement path="${build.dir}/cytoscape-task.jar"/>
    <fileset dir="${lib.dir}">
      <include name="*.jar"/>
    </fileset>
  </path>

  <target name="doc">
    <javadoc destdir="${javadoc.dir}"
             source="1.4"
             windowtitle="Javadoc - cytoscape.task packages">
      <fileset dir="${src.dir}">
        <include name="cytoscape/task/*.java"/>
        <include name="cytoscape/task/ui/*.java"/>
        <include name="cytoscape/task/util/*.java"/>
        <include name="cytoscape/task/sample/*.java"/>
      </fileset>
      <classpath>
        <fileset dir="${lib.dir}">
          <include name="*.jar"/>
        </fileset>
      </classpath>
    </javadoc>
  </target>

  <!-- This does not do anything useful by itself; used by other targets. -->
  <target name="init">
    <uptodate property="buildfile-generated"
              targetfile="${build.dir}/build.xml">
      <srcfiles dir="${basedir}/.build"
                includes="GenerateBuildFile.java"/>
    </uptodate>
  </target>

  <target name="prepare" depends="init" unless="buildfile-generated">
    <copy todir="${temp.src.dir}/buildgen"
          file="${basedir}/.build/GenerateBuildFile.java"/>
    <mkdir dir="${classes.dir}/buildgen"/>
    <javac destdir="${classes.dir}/buildgen"
           srcdir="${temp.src.dir}/buildgen"
           debug="true"
           includeAntRuntime="no"/>
    <delete file="${build.dir}/build.xml"/>
    <java fork="true" classname="GenerateBuildFile" failonerror="true"
          output="${build.dir}/build.xml">
      <classpath path="${classes.dir}/buildgen"/>
      <arg value="cytoscape.task framework"/>
      <arg value="${src.dir}"/>
      <arg value="${lib.dir}"/>
      <arg value="${build.dir}/cytoscape-task.jar"/>
      <arg value="${temp.src.dir}"/>
      <arg value="${classes.dir}"/>
      <arg value="${little.jars.dir}"/>
    </java>
    <!-- Take away write permission on autogenerated file. -->
    <chmod file="${build.dir}/build.xml" perm="ugo-wx"/>
    <delete dir="${temp.src.dir}/buildgen"/>
    <delete dir="${classes.dir}/buildgen"/>
  </target>

  <!-- To add your package to the build system, add a DEPENDENCIES     -->
  <!-- file to your package directory listing all dependent packages,  -->
  <!-- one per line.                                                   -->
  <target name="compile" depends="prepare">
    <ant antfile="${build.dir}/build.xml" target="littlejars"/>
  </target>

  <target name="jar" depends="prepare">
    <ant antfile="${build.dir}/build.xml"/>
  </target>

  <!--  Target to Create Run Samples -->
  <target name="sample0" depends="jar"
          description="Runs Sample0:  Illustrates BareBones JTask">
    <java classname="cytoscape.task.sample.RunSampleTask"
          classpathref="classpath" fork="true" maxmemory="512m">
    </java>
  </target>

  <target name="sample1" depends="jar"
    description="Runs Sample1:  Illustrates Customized JTask with popup delay">
    <java classname="cytoscape.task.sample.RunSampleTask"
          classpathref="classpath" fork="true" maxmemory="512m">
      <arg line="1"/>
    </java>
  </target>

  <target name="sample2" depends="jar"
          description="Runs Sample2:  Illustrates Exception Handling">
    <java classname="cytoscape.task.sample.RunSampleTask"
          classpathref="classpath" fork="true" maxmemory="512m">
      <arg line="2"/>
    </java>
  </target>
    
  <!--  Target to Run CheckStyle on all Source Code -->
  <!--  Uses the Sun Coding Conventions Configuration -->
  <target name="check" description="Checks Sun Coding Conventions">
        <checkstyle config="${config.dir}/sun_checks.xml">
              <fileset dir="${src.dir}">
                <include name="**/*.java"/>
		<exclude name="archive/**.*"/>
            </fileset>
          </checkstyle>
  </target>
</project>
