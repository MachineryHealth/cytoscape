<?xml version="1.0"?>
<!-- build.xml - Build file for Sample Cytoscape Plugin -->
<project name="Cytoscape" default="jar" basedir=".">

        <!-- Ant build file for homology plugin.
             By David Reiss, dreiss@systemsbiology.org -->
	
	<!-- Name of Plug In -->
	<property name="plugin.name" value="getInteractions"/>

  	<property name="src.dir" value="src"/>
	<property name="cs.dir" value="../../../../cytoscape"/>
        <property name="lib.dir" value="${basedir}/../lib"/>

	<property name="httpdata.dir" value="../httpdata"/>
	<property name="sequence.dir" value="../sequence"/>
	<property name="cytotalk.dir" value="../cytoTalk"/>
	
  	<!-- Temporary build directories -->
 	<property name="build.dir" value="build"/>
  	<property name="build.classes" value="${build.dir}/classes"/>
	
	<!-- Global "magic" property for <javac> -->
	<property name="build.compiler" value="modern"/>
	<!--<property name="build.compiler" value="jikes"/> -->
	
	<!-- Classpath with all lib JAR Files and all Cytoscape Core classes -->
	<path id="classpath">	
		<fileset dir="${httpdata.dir}"><include name="**/*.jar"/></fileset>
		<fileset dir="${sequence.dir}"><include name="**/*.jar"/></fileset>
		<fileset dir="${cytotalk.dir}"><include name="**/*.jar"/></fileset>
		<fileset dir="${cs.dir}/lib"><include name="**/*.jar"/></fileset>
		<pathelement location="${build.classes}"/>	
		<pathelement location="${cs.dir}/build/classes"/>
	</path>

	<!-- Target to compile httpdata class files  -->
	<target name="build_httpdata">
		<ant antfile="${httpdata.dir}/build.xml" inheritAll="false" target="jar"/>
	</target>

	<!-- Target to compile sequence plugin class files  -->
	<target name="build_sequence">
		<ant antfile="${sequence.dir}/build.xml" inheritAll="false" target="jar"/>
	</target>

	<!-- Target to compile cytotalk plugin class files  -->
	<target name="build_cytotalk">
		<ant antfile="${cytotalk.dir}/build.xml" inheritAll="false" target="jar"/>
	</target>

	<!--  Target to compile all Plug In Code -->
  	<target name="build" depends="build_sequence,build_cytotalk">
    		<mkdir dir="${build.dir}"/>
    		<mkdir dir="${build.classes}"/>
    		<javac srcdir="${src.dir}:${basedir}/../util/src" destdir="${build.classes}" nowarn="on" 
		                           source="1.4" listfiles="yes" debug="yes">
			<include name="csplugins/**"/>
			<classpath refid="classpath"/>
		</javac>
                <copy todir="${build.classes}/csplugins/isb/dreiss">
                    <fileset dir="${basedir}/../resources">
                        <include name="getInteractions.properties"/>
                        <include name="httpdata.properties"/>
                        <include name="cytoTalk.properties"/>
                    </fileset>
                </copy>
	</target>

        <target name="jar" depends="build">
           <taskdef resource="genjar.properties" classpath="${lib.dir}/GenJar.jar"/>
           <!--<delete file="${build.dir}/${plugin.name}.jar"/>-->
           <genjar jarfile="${build.dir}/${plugin.name}.jar">
	      <classpath refid="classpath"/>
              <class><fileset dir="${build.classes}">
                 <include name="**/*.class"/>
              </fileset></class>
              <resource><fileset dir="${build.classes}">
                 <include name="**/*.properties"/>
              </fileset></resource>
	      <!--<library jar="${httpdata.dir}/build/httpdata.jar"/>
	      <library jar="${sequence.dir}/build/sequence.jar"/>-->
              <classfilter>
                 <exclude name="cytoscape."/>
                 <exclude name="y."/>
                 <exclude name="ptolemy."/>
                 <exclude name="Acme."/>
                 <exclude name="junit."/>
                 <exclude name="org.hsqldb."/>
                 <exclude name="com.mysql.jdbc."/>
                 <exclude name="org.xml.sax."/>
                 <exclude name="giny."/>
              </classfilter>
           </genjar>                    
        </target>

  	<!--  Target to Run Cytoscape with non-obfuscated jar file and this plugin -->
  	<target name="run" depends="jar">
		<java classname="cytoscape.cytoscape" fork="true" failonerror="false">
			<classpath refid="classpath"/>
                        <jvmarg line="-Xmx200m -Xms200m"/>
                        <arg line="-x -p data/project"/>
		</java>
	</target>

  	<!--  Target to profile Cytoscape with non-obfuscated jar file and this plugin -->
  	<target name="profile" depends="jar">
		<java classname="cytoscape.cytoscape" fork="true" failonerror="false">
			<classpath refid="classpath"/>
                        <jvmarg line="-Xmx200m -Xms200m -Xrunjmp:noobjects,nomonitors,nomethods"/>
                        <arg line="-x -p data/project"/>
		</java>
	</target>
</project>
