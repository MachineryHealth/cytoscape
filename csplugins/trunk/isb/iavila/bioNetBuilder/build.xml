<project name = "BioNetBuilder" default = "compile" basedir = ".">
    <description>
    This build.xml file compiles and creates jars for the BioNetBuilder plugin
    </description>
    <!-- Set the global properties for this build -->
	<property name = "basedir" value = "."/>
	<property name = "plugin.name" value = "BioNetBuilderPlugin"/>
    <property name = "src" location = "src"/>
    <property name = "build" location = "build"/>
    <property name = "build.compiler" value = "modern"/>
	<property name = "local.lib" value="lib"/>
	<property name = "lib.jar" value = "BioNetBuilderLib"/>
	<property name = "jar"  location = "jar"/>
    <property name = "server.class" value="org.isb.xmlrpc.server.MyWebServer"/>
	<property name = "server.args" value = "8084 /Users/iavila/Documents/workspace/csplugins/isb/iavila/bioNetBuilder/xmlrpc.props"/>
	<property name ="manifest" value = "bionetbuilder.manifest"/>
    
	<!-- CHANGE THIS TO YOUR CYTOSCAPE PATHS: -->
	<property name = "cytoscape22" value="../../../../cytoscape-v2.2/"/>
	<property name = "cytoscapeCVS" value ="../../../../cytoscape"/>
    <property name = "cytoscape22.plugins" value ="../../../../cytoscape-v2.2/plugins"/>
	<property name = "cytoscapeCVS.plugins" value ="../../../../cytoscape/plugins/core"/>
	
	<property name = "cytoscape" value = "${cytoscapeCVS}"/>
	<property name = "cytoscape.plugins" value = "${cytoscapeCVS.plugins}"/>
	
    <!-- classpath for compiling -->
    <path id = "classpath">
    	    <fileset dir = "${cytoscape}">
    	    		<include name = "**/*.jar"/>
    	    	</fileset>
    		<fileset dir = "${cytoscape}/lib">
    	    		<include name = "**/*.jar"/>
    	    	</fileset>
    		<fileset dir = "${local.lib}">
    	    		<include name = "**/*.jar"/>
    	    	</fileset>
    </path>
   <!-- classpath for starting the server -->
	<path id = "server_classpath">
		<fileset dir = "${jar}">
			<include name = "**/*.jar"/>
		</fileset>
	    </path>

    <!-- prepare target, creates necessary directories for building -->
    <target name = "prepare">
       <!-- Create a time stamp -->
       <tstamp/>
       <!-- Create the build directory used by compile -->
       <mkdir dir = "${build}"/>
    </target>
    
    <!-- compile target -->
    <target name="compile" depends="prepare" description="Compiles BioNetBuilder">
       <javac srcdir="${src}"
              destdir="${build}"
              nowarn="off"
              debug="true"
              debuglevel="source"
              source="1.4"
              optimize="on"
              includeAntRuntime="false"
              deprecation="on">
              <classpath refid="classpath"/>
       </javac>
    </target>

    <!-- clean target -->
    <target name="clean">
       <delete dir="${build}"/>
    </target>
	
	<!-- this works with Cytoscape in CVS -->
	<!-- ontologyLib.jar contains in it xmlrpcClient.jar -->
	<target name="jarclient" depends="compile" description="Creates a jar of BioNetBuilder to load into Cytoscape as a plugin">
		<unjar overwrite="Yes" dest = "${build}">
			<fileset dir = "${local.lib}">
				<include name="ontologyLib.jar"/>
				<include name="utils.jar"/>
			</fileset>
		</unjar>
		<jar destfile = "${jar}/bionetbuilderClient.jar">
	    		<fileset dir = "${build}"/>
	    	</jar>
		<copy file="${jar}/bionetbuilderClient.jar" todir="${cytoscape.plugins}"/>
		<echo message="bionetbuilderClient.jar is complete, it is located in ${jar} and in ${cytoscape.plugins}"/>
	</target>
	
	<!-- this works with Cytoscape in CVS -->
	<!-- ontologyLibOnly.jar does not contain any xmlRpc classes -->
		<target name="jarserver" depends="compile" description="Creates a jar of BioNetBuilder that should be used for the server">
			<unjar overwrite="Yes" dest = "${build}">
				<fileset dir = "${local.lib}">
					<include name="xmlrpcServer.jar"/>
					<include name="utils.jar"/>
					<include name="ontologyLibOnly.jar"/>
				</fileset>
			</unjar>
			<jar destfile = "${jar}/bionetbuilderServer.jar">
		    		<fileset dir = "${build}"/>
		    	</jar>
			<echo message="bionetbuilderServer.jar is complete, it is located in ${jar}"/>
		</target>
	

	<!-- Run a class MYCLASS (from the ${build} directory) with the command line 'MY ARGS' via:
	             ant run -Dclass=${class} -Dargs='MY ARGS' -->
	<target name="runserver">
	    <echo message="${server.class} ${server.args}"/>
	    <java classname="${server.class}" fork="true" failonerror="no">
	         <classpath refid="server_classpath"/>
	         <arg line="${server.args}"/>
	    </java>
	</target>
	

	<!-- Shuts down the server -->
	<target name="killserver">
		    <echo message="${server.class} ${server.args}"/>
		    <java classname="org.apache.xmlrpc.XmlRpcClientLite" fork="true" failonerror="no">
		         <classpath refid="server_classpath"/>
		         <arg line="http://wavelength.systemsbiology.net:8084"/>
		    	     <arg line="server.shutdown"/>
		    </java>
		</target>
	
	<!-- Target to Run JavaDoc -->
    <target name="doc" description="Runs JavaDoc.">
        <javadoc packagenames="org.*" sourcepath="src" source="1.4" destdir="doc"> 
        <link href = "http://java.sun.com/j2se/1.4.2/docs/api/"/>
        </javadoc>
    </target>

</project>
