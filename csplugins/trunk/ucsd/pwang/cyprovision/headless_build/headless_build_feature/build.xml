<?xml version="1.0" encoding="UTF-8"?>
<project name="Build cytoscape feature" default="feature-build">

	<!-- Location of coniguration files -->
	<property name="builder" location="." />
	<!-- Identifier for the feature being built-->
	<property name="base" location="c:/eclipse35" />
	<!-- parent of base location-->
	<property name="baseLocation" location="${base}/eclipse" />
	<property name="buildDirectory" location="${builder}/build_feature" />

	<!-- Define the location of cytoscape bundles and rootfiles -->	
	<property name="cy3bundleDirectory" location="./cy3bundles" />
	<property name="rootfilesDirectory" location="./rootfiles" />

	<pathconvert property="equinoxLauncher">
		<path>
			<fileset dir="${baseLocation}/plugins" includes="**/*.jar" />
		</path>
		<regexpmapper from="(org\.eclipse\.equinox\.launcher)(_)(.*)\.jar" to="\0" />
	</pathconvert>

	<!--
		This target actually executes the PDE Build process by launching the 
		Eclipse antRunner application.
	-->
	<target name="feature-build" depends="init">	

		<java classname="org.eclipse.equinox.launcher.Main" fork="true" failonerror="true" >
			<arg value="-application" />
			<arg value="org.eclipse.ant.core.antRunner" />
			<arg value="-buildfile" />
			<arg value="build_cy3_feature.xml" />
			<classpath>
				<pathelement location="${baseLocation}/plugins/${equinoxLauncher}" />
			</classpath>

		</java>	
	</target>
	
	<target name="init">
	
		<delete dir="${buildDirectory}" />
		<mkdir dir="${buildDirectory}" />
		
		<record name="${buildDirectory}/cytoscape-feature-build.log"
			loglevel="verbose" />
		<echoproperties />

		<mkdir dir="${buildDirectory}/features/cytoscape_product_feature" />
		<copy todir="${buildDirectory}/features/cytoscape_product_feature" file="feature.xml" />
		<copyfile src="feature_build.properties" dest="${buildDirectory}/features/cytoscape_product_feature/build.properties"  />
			
		<mkdir dir="${buildDirectory}/plugins" />
		<copy todir="${buildDirectory}/plugins" >
			<fileset dir="${cy3bundleDirectory}">
				<include name="**" />
			</fileset>
		</copy>
		
		<mkdir dir="${buildDirectory}/rootfiles" />
		<copy todir="${buildDirectory}/rootfiles" >
			<fileset dir="${rootfilesDirectory}">
				<include name="**" />
			</fileset>
		</copy>
		
	</target>

</project>