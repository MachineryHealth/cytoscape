<project name="Build specific targets and properties" default="postBuild">


	<!-- ===================================================================== -->
	<!-- Steps to do after the build is done. -->
	<!-- ===================================================================== -->
	<property name="baseLocation" value="." />

	<property name="buildDirectory" value="/work_cy3" />
	<property name="cytoscapeVersion" value="3.0.0" />
	
	<target name="postBuild">
				
		<mkdir dir="${buildDirectory}/build/tmp" />
		<antcall target="run.director">
			<param name="p2.metadata.repo" value="file:c:/work_cy3/cy3repo" />
			<param name="p2.artifact.repo" value="file:c:/work_cy3/cy3repo" />
			<param name="p2.flavor" value="tooling" />
			<param name="p2.profile" value="CytoscapeProfile" />
			<param name="p2.director.install.path" value="${buildDirectory}/build/tmp/cytoscape"/>
			<param name="p2.os" value="win32"/>
			<param name="p2.ws" value="win32"/>
			<param name="p2.arch" value="x86"/>
			<param name="p2.IU" value="cytoscape300IU" />
			<param name="p2.version" value="${cytoscapeVersion}"/>

		</antcall>
		<zip destfile="${buildDirectory}/build/cytosape-${cytoscapeVersion}.zip" basedir="${buildDirectory}/build/tmp" />
		<delete dir="${buildDirectory}/build/tmp" />

	</target>

	<target name="run.director">
		<exec executable="${baseLocation}/eclipsec" failonerror="false" timeout="900000">
			<arg line="-application org.eclipse.equinox.p2.director.app.application" />
			<arg line="-nosplash" />
			<arg line="--launcher.suppressErrors" />
			<arg line="-consoleLog" />
			<arg line="-flavor ${p2.flavor}" />
			<arg line="-installIU ${p2.IU}" />
			<arg line="-version ${p2.version}" />
			<arg line="-p2.os ${p2.os}" />
			<arg line="-p2.ws ${p2.ws}" />
			<arg line="-p2.arch ${p2.arch}" />
			<arg line="-roaming" />
			<arg line="-profile ${p2.profile}" />
			<arg line="${p2.director.extraArgs}" />
			<arg line="-metadataRepository ${p2.metadata.repo}" />
			<arg line="-artifactRepository ${p2.artifact.repo}" />
			<arg line="-destination ${p2.director.install.path}" />
			<arg line="-bundlepool ${p2.director.install.path}" />
			<arg line="-vmargs" />
			<arg line="-Declipse.p2.data.area=${p2.director.install.path}/p2" />
		<!--	<arg line="-Xdebug -Xnoagent -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8888" />-->
		</exec>
		
		<!-- delete the metadata cache as well as the artifacts for unzipped bundles -->
		<delete failonerror="false" includeEmptyDirs="true" dir="${p2.director.install.path}/p2/org.eclipse.equinox.p2.core/cache" />
	</target>

</project>
