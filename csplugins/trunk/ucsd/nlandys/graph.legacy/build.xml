<?xml version="1.0"?>

<project name="cytoscape.graph.legacy" default="compile" basedir=".">
  <property name="src.dir" value="${basedir}/src"/>
  <property name="lib.dir" value="${basedir}/lib"/>
  <property name="build.dir" value="${basedir}/build"/>
  <property name="javadoc.dir" value="${build.dir}/API-doc"/>
  <property name="temp.src.dir" value="${build.dir}/tempsrc"/>
  <property name="classes.dir" value="${build.dir}/classes"/>
  <property name="little.jars.dir" value="${build.dir}/littlejars"/>

  <target name="clean">
    <delete dir="${build.dir}"/>
  </target>

  <!-- This does not do anything useful by itself; used by other targets. -->
  <target name="init">
    <echo>
WARNING!!!  All code in this project is deprecated.  You
should avoid using or looking at this code at all costs.
    </echo>
    <uptodate property="buildfile-generated"
              targetfile="${build.dir}/build.xml">
      <srcfiles dir="${basedir}/.build"
                includes="GenerateBuildFile.java"/>
    </uptodate>
  </target>

  <target name="prepare" depends="init" unless="buildfile-generated">
    <copy todir="${temp.src.dir}/buildgen"
          file="${basedir}/.build/GenerateBuildFile.java"/>
    <mkdir dir="${classes.dir}/buildgen"/>
    <javac destdir="${classes.dir}/buildgen"
           srcdir="${temp.src.dir}/buildgen"
           debug="on"
           includeAntRuntime="no"/>
    <delete file="${build.dir}/build.xml"/>
    <java fork="true" classname="GenerateBuildFile" failonerror="true"
          output="${build.dir}/build.xml">
      <classpath path="${classes.dir}/buildgen"/>
      <arg value="cytoscape.graph.legacy framework"/>
      <arg value="${src.dir}"/>
      <arg value="${lib.dir}"/>
      <arg value="${build.dir}/cytoscape-graph-legacy.jar"/>
      <arg value="${temp.src.dir}"/>
      <arg value="${classes.dir}"/>
      <arg value="${little.jars.dir}"/>
    </java>
    <!-- Take away write permission on autogenerated file. -->
    <chmod file="${build.dir}/build.xml" perm="ugo-wx"/>
    <delete dir="${temp.src.dir}/buildgen"/>
    <delete dir="${classes.dir}/buildgen"/>
  </target>

  <!-- To add your package to the build system, add a DEPENDENCIES     -->
  <!-- file to your package directory listing all dependent packages,  -->
  <!-- one per line                                                    -->
  <target name="compile" depends="prepare">
    <ant antfile="${build.dir}/build.xml" target="littlejars"/>
  </target>

  <target name="jar" depends="prepare">
    <ant antfile="${build.dir}/build.xml"/>
  </target>

</project>
