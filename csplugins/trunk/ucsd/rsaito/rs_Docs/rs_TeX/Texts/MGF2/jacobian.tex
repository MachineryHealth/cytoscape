\section{多変量の確率密度関数の変数変換}

\begin{figure}
\begin{center}
\includegraphics[scale=0.75]{Figures/jacobian1}
\end{center}
\vspace{-2em}
\caption{2変数の変換のイメージ}
\label{jacobian1}
\end{figure}

既に小節\ref{subsec_multivar105}で学んだように、確率密度関数$f(x,y)$が与えられたとき、$(X,Y)\in D$となる確率は
$P((X,Y)\displaystyle \in D)=\int\int_{D}f(x,y)dxdy$
で与えられる。仮に確率変数$X,Y$が

\begin{eqnarray}
X & = & \varphi(U,V)\label{eq_jacob_start105}\\
Y & = & \psi(U,V)\label{eq_jacob_start106}
\end{eqnarray}

\noindent
と別の確率変数$U,V$で表されるとき、$U,V$の従う確率密度関数はどのようなものになるだろうか。
そもそも2変量の確率密度関数の重積分$\displaystyle \int\int_{D}f(x,y)dxdy$は
$\displaystyle \sum_{(x_{i},y_{i})\in D}f(x_{i},y_{i})\Delta_{x_{i},y_{i}}$において全ての$\Delta_{x_{i},y_{i}}$が0に近づくときの極限である。$f(x_{i},y_{i})$は$f(\varphi(u,v),\psi(u,v))$と
簡単に$u,v$の関数として表すことができる。
以下、$\Delta_{x_{i},y_{i}}$が$u,v$によってどのように表現されるかを考察していこう。

図\ref{jacobian1}に示すように、
$D^{\prime}$上の各小領域\(S'_{u_{i},v_{i}}\)(図\ref{jacobian1}の長方形\({\rm P_{1}'P_{2}'P_{3}'P_{4}'P_{1}'}\)に
相当)が
式\ref{eq_jacob_start106}によって$D$上の小領域\(S_{x_{i},y_{i}}\)
(図\ref{jacobian1}の曲線\({\rm P_{1}P_{2}P_{3}P_{4}P_{1}}\)で囲まれた領域に相当)
に移るとしよう。このとき\(S'_{u_{i},v_{i}}\)内の任意の内部の点\({\rm P'}\)は
\(S_{x_{i},y_{i}}\)内の内部の点\({\rm P}\)に移るとする。
重積分の定義から、
領域\(D\)を面積\(\Delta_{x_{i},y_{i}}\)の各小領域\(S_{x_{i},y_{i}}\)に分けても、
ベクトル\({\rm P_{1}P_{2}}\)とベクトル\({\rm P_{1}P_{4}}\)に対応する線分を2つの辺とするような
面積\(\Delta S^{*}_{x_{i},y_{i}}\)の平行四辺形\(S^{*}_{x_{i},y_{i}}\)に分けても、その重積分の値は
変わらない。すなわち、

\begin{equation}
\int\int_{D}f(x,y)dxdy
=\lim_{\Delta_{x_{i},y_{i}}\to 0}\sum f(x_{i},y_{i})\Delta_{x_{i},y_{i}}
=\lim_{\Delta S^{*}_{x_{i},y_{i}}\to 0}\sum f(x_{i},y_{i})\Delta S^{*}_{x_{i},y_{i}}
\label{eq_jacob505}
\end{equation}

\noindent
そこで、領域\(D\)を平行四辺形の小領域に分けて重積分を行うことを考え、\(\Delta S^{*}_{x_{i},y_{i}}\)
を求めてみよう\footnote{図\ref{jacobian1}(a)の曲線\(u\)、\(v\)、\(u+\Delta u\)、\(v+\Delta v\)のいずれも
\(\Delta u\to 0\)、\(\Delta v\to 0\)のとき、平行四辺形の2辺によって近似されていくことに注意。}。
点P\(_{i}\)を$(x_{i},y_{i})$で表せば、まず

\begin{eqnarray}
x_{1} & = & \varphi(u,v)\nonumber\\
y_{1} & = & \psi(u,v)\nonumber
\end{eqnarray}

\noindent
である。偏微分の定義(式\ref{eqn_part_deriv1})より、

\begin{eqnarray}
\lim_{\Delta u\rightarrow 0}\frac{\varphi(u+\Delta u,v)-\varphi(u,v)}{\Delta u} & = & \frac{\partial\varphi}{\partial u}\nonumber\\
\lim_{\Delta v\rightarrow 0}\frac{\varphi(u,v+\Delta v)-\varphi(u,v)}{\Delta v} & = & \frac{\partial\varphi}{\partial v}\nonumber
\end{eqnarray}

\noindent
と表せるから、\(\Delta u\to 0\)、\(\Delta v\to 0\)のとき、

\begin{eqnarray}
x_{2} & = & \varphi(u+\Delta u,v)=\varphi(u,v)+\frac{\partial\varphi}{\partial u}\Delta u\nonumber\\
y_{2} & = & \displaystyle \psi(u+\Delta u,v)=\psi(u,v)+\frac{\partial\psi}{\partial u}\Delta u\nonumber\\
x_{4} & = & \displaystyle \varphi(u,v+\Delta v)=\varphi(u,v)+\frac{\partial\varphi}{\partial v}\Delta v\nonumber\\
y_{4} & = & \displaystyle \psi(u,v+\Delta v)=\psi(u,v)+\frac{\partial\psi}{\partial v}\Delta v\nonumber
\end{eqnarray}

\noindent
となる。そして全微分(式\ref{eqn_total_deriv})を表す

\begin{displaymath}
\displaystyle \lim_{\Delta u\rightarrow 0}\lim_{\Delta v\rightarrow 0}\varphi(u+\Delta u,v+\Delta v)-\varphi(u,v)=\frac{\partial\varphi}{\partial u}\Delta u+\frac{\partial\varphi}{\partial v}\Delta v
\end{displaymath}

\noindent
に注意すると、

\begin{eqnarray}
x_{3} & = & \displaystyle \varphi(u+\Delta u,v+\Delta v)=\varphi(u,v)+\frac{\partial\varphi}{\partial u}\Delta u+\frac{\partial\varphi}{\partial v}\Delta v\nonumber\\
y_{3} & = & \displaystyle \psi(u+\Delta u,v+\Delta v)=\psi(u,v)+\frac{\partial\psi}{\partial u}\Delta u+\frac{\partial\psi}{\partial v}\Delta v\nonumber
\end{eqnarray}

\noindent
となる。これより4つのベクトルは、

\begin{eqnarray}
{\rm P_{1}P_{2}}=(x_{2}-x_{1},y_{2}-y_{1}) 
& = &
(\frac{\partial\varphi}{\partial u}\Delta u, \frac{\partial\psi}{\partial u}\Delta u)\nonumber\\
{\rm P_{1}P_{4}}=(x_{4}-x_{1},y_{4}-y_{1})
& = & 
(\frac{\partial\varphi}{\partial v}\Delta v, \frac{\partial\psi}{\partial v}\Delta v)\nonumber\\
{\rm P_{2}P_{3}}=(x_{3}-x_{2},y_{3}-y_{2})
& = & 
(\frac{\partial\varphi}{\partial v}\Delta v, \frac{\partial\psi}{\partial v}\Delta v)\nonumber\\
{\rm P_{4}P_{3}}=(x_{4}-x_{3},y_{4}-y_{3}) 
& = &
(\frac{\partial\varphi}{\partial u}\Delta u, \frac{\partial\psi}{\partial u}\Delta u)\nonumber
\end{eqnarray}
%$\Delta_{i}(x,y)$とみなす。

\noindent
となる。\({\rm P_{1}P_{2}}={\rm P_{4}P_{3}}\)、\({\rm P_{1}P_{4}}={\rm P_{2}P_{3}}\)より、\(\Delta u\to 0\)、\(\Delta v\to 0\)のとき、4つのベクトルで囲まれる図形は平行四辺形に
近づくことが分かる。ここでそのベクトル\({\rm P_{1}P_{2}}\)とベクトル\({\rm P_{1}P_{4}}\)に対応する線分を
2つの辺とする平行四辺形を考え、その面積を$\Delta S^{*}$とする。
小節\ref{subsec_det_volume10}(p.\pageref{subsec_det_volume10})で述べた行列式と平行四辺形の面積との
関係を使えば、

\begin{equation}
\Delta S^{*}=
\left|\left|\begin{array}{l}
\frac{\partial\varphi}{\partial u} \frac{\partial\varphi}{\partial v}\\
\frac{\partial\psi}{\partial u} \frac{\partial\psi}{\partial v}
\end{array}\right|\right|\Delta u\Delta v
=\left|\frac{\partial(x,y)}{\partial(u,v)}\right|\Delta u\Delta v=|J|\Delta u\Delta v
\label{eq_jacob_2_100}
\end{equation}

\noindent
ここで
$J=\frac{\partial(x,y)}{\partial(u,v)}=\left|\begin{array}{l}
\frac{\partial\varphi}{\partial u} \frac{\partial\varphi}{\partial v}\\
\frac{\partial\psi}{\partial u} \frac{\partial\psi}{\partial v}
\end{array}\right|$は{\bf ヤコビアン(Jacobian)}\index{やこびあん@ヤコビアン}または
{\bf ヤコビ行列式}\index{やこびぎょうれつしき@ヤコビ行列式}と呼ばれる。
%$\Delta S^{\prime}=\Delta u\Delta v$として、

%\begin{equation}
%\Delta S=|J|\Delta S^{\prime}
%\end{equation}
%
%\noindent
%を得る。
%$D$上で定義された$f(x,y)$の$x,y$に最初の式を代入すれば、$f(\varphi(u,v),\psi(u,v))$は$D^{\prime}$上の関数である。

\vspace{1em}

\noindent
式\ref{eq_jacob_2_100}を使えば、式\ref{eq_jacob505}は

\begin{equation}
\lim_{\Delta S^{*}_{x_{i},y_{i}}\to 0}\sum f(x_{i},y_{i})\Delta S^{*}_{x_{i},y_{i}}
=\lim_{\Delta u\to 0,\ \Delta v\to 0}\sum f(\varphi(u,v),\psi(u,v))|J|\Delta u \Delta v
\end{equation}

\noindent
となる。ゆえに、

\begin{equation}
\int\int_{D}f(x,y)dxdy=\int\int_{D^{\prime}}f(\varphi(u,v),\psi(u,v))|J|dudv
\end{equation}


\vspace{1em}

\refstepcounter{preexer}

\noindent
{\bf 例題\thechapter-\thepreexer}:~
$X,Y$が相互に独立に$N(0,1)$に従う確率変数とする。このとき、$U=X+Y$の分布を表す確率密度関数を求めよう。
$x,y$の結合確率密度関数$f(x,y)$は

\begin{equation}
f(x,y)=\displaystyle \frac{1}{\sqrt{2\pi}}e^{-\frac{x^{2}}{2}}\cdot\frac{1}{\sqrt{2\pi}}e^{-\frac{x^{2}}{2}}=\frac{1}{2\pi}e^{-\frac{1}{2}(x^{2}+y^{2})}
\end{equation}

\noindent
である。今、

\begin{eqnarray}
u & = & x+y\nonumber\\
v & = & y\nonumber
\end{eqnarray}

\noindent
とおく。これは

\begin{eqnarray}
x & = & u-v\nonumber\\
y & = & v\nonumber
\end{eqnarray}

\noindent
と同じである。対応するヤコビアンは、

\begin{displaymath}
J=\left|\begin{array}{rr}
1 & -1\\
0 &  1
\end{array}\right|=1
\end{displaymath}

\noindent
従って確率変数$U,V$の確率密度関数$g(u,v)$は、

\begin{displaymath}
g(u,v)=\frac{1}{2\pi}e^{-\frac{1}{2}\{(u-v)^{2}+v^{2}\}}\cdot 1=\frac{1}{2\pi}e^{-\frac{1}{2}\{(u-v)^{2}+v^{2}\}}
\end{displaymath}

\noindent
となる。求めたいのは、$V$の値によって場合分けされていない、$U$の従う分布だから、$V$の取り得るあらゆる値に
ついて積分して、

\begin{displaymath}
h(u)=\displaystyle \int_{-\infty}^{\infty}\frac{1}{2\pi}e^{-\frac{1}{2}(u^{2}-2uv+2v^{2})}dv
\end{displaymath}

\noindent
が求める確率密度関数になる。$e$のべき指数は、

\begin{eqnarray}
-\displaystyle \frac{1}{2}(u^{2}-2uv+2v^{2}) & = & -\frac{1}{2}u^{2}-\frac{1}{2}(2v^{2}-2uv)\nonumber\\
& = & -\displaystyle \frac{1}{2}u^{2}-\frac{1}{2}\frac{1}{\left(\frac{1}{\sqrt{2}}\right)^{2}}\left\{\left(v-\frac{1}{2}u\right)^{2}-\frac{1}{4}u^{2}\right\}\nonumber\\
& = & -\displaystyle \frac{1}{2}u^{2}(1-\frac{1}{2})-\frac{1}{2}\frac{1}{\left(\frac{1}{\sqrt{2}}\right)^{2}}\left(v-\frac{1}{2}u\right)^{2}\nonumber
\end{eqnarray}

\noindent
それゆえ、\(\int_{-\infty}^{\infty}\frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{(x-\mu)^{2}}{2\sigma^{2}}}dx=1\)に注意すれば、

\begin{equation}
h(u)=\displaystyle \frac{1}{\sqrt{2\pi}}e^{-\frac{1}{2}u^{2}\left(\frac{1}{\sqrt{2}}\right)^{2}}\int_{-\infty}^{\infty}\frac{1}{\sqrt{2\pi}}e^{-\frac{1}{2}\frac{1}{\left(\frac{1}{\sqrt{2}}\right)^{2}}(v-\frac{1}{2}u)^{2}}dv
=\displaystyle \frac{1}{\sqrt{2\pi}}e^{-\frac{1}{2}\left(\frac{u}{\sqrt{2}}\right)^{2}}\cdot\left(\frac{1}{\sqrt{2}}\right)
\end{equation}

\noindent
が得られる。このようにして、$u=x+y$は$N(0,2)$に従うことが分かる。



