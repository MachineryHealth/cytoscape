\chapter{RNAの二次構造予測}

\begin{abstract}

RNA分子はA,C,G,Uの塩基からなる一本鎖の核酸配列です。二本鎖であるDNAとは
異なり、比較的自由に折れ曲がることができるため、その立体構造も様々です。
RNAにはmRNAやtRNA,rRNAなど様々な種類のものがあります。また最近では生体内
でタンパク質に翻訳されないRNAがたくさんあることが判明し、注目されていま
す。RNA分子の機能は多くの場合、その立体構造に依存しています。従ってRNAの
立体構造と機能との関係を調べることは大変重要です。RNAの三次元構造を配列
から予測することはまだ困難ですが、単にどの塩基とどの塩基が対合するかとい
うことを予測する二次構造予測に関しては手法がある程度確立されています。そ
こで本章では、与えられたRNA分子がどのような二次構造をとるかを予測する手
法について解説します。

\end{abstract}

\section{RNAとその二次構造}

RNA分子はDNAと同様、細胞内に多く存在する核酸の一種です。RNAにはタンパク
質を合成するときの鋳型となるmRNA、コドンをアミノ酸に変換するtRNA、リボソ
ームの中に存在してタンパク質の合成を行うrRNAなど様々な種類のものが存在し
ます。また最近では細胞内にはタンパク質に翻訳されない非翻訳RNAが多数存在
し、その一部は生体内で重要な役割を果たしていることが分かってきました
\cite{ncRNA_numassan}。

DNAは二本鎖であり、あまり自由に折れ曲がることができないため、mRNA
の鋳型になる以外の機能は限られています。これに対し、RNAは一本鎖であり、
DNAに比べると比較的自由に折れ曲がることができるため、その構造によって様々
な機能を持つことが可能なのです。従ってRNAの機能を考える上で、その構造を
調べることは非常に重要です。

RNAはA,C,G,Uの4文字からなる配列で、AとU、CとGは結合しやすくなっています。
RNA配列の中でどの塩基とどの塩基が結合しているかを表現したものをRNAの二次
構造と呼びます。RNAの構造を決める大きな要因はその一次配列です。一次配列
から三次元構造を予測することが現段階ではまだ困難ですが、二次構造を予測す
る手法は実用化されています\cite{Bioinfo_endo}。そこで本章では、RNAの二次
構造を予測する方法について学びましょう。

\section{RNA二次構造の表現}

\begin{figure}
\includegraphics[scale=0.45]{Figures_EPS/RNA_2d_str_exp.eps}
\caption{RNA二次構造の表現方法}
\label{RNA_2d_str_exp}
\end{figure}

まず、RNAの二次構造を扱うためには、それをどのように表現するかを考えなけ
ればなりません。RNAの二次構造を表現する最も直接的な方法は、図
\ref{RNA_2d_str_exp}(a)のように実際に図を描くことです。また、配列を円形
にして対合部分を線で結んだのが図\ref{RNA_2d_str_exp}(b)です。これらは
直感的には分かりやすいのですが、二次構造を数学的に扱ったり、プログラ
ムとして実装したりすることを考えるときは必ずしも直接扱いやすい表現方法と
は言えません。そこでまずRNA配列の各塩基に対して、先頭より順番に番号を付
け、図\ref{RNA_2d_str_exp}(c)のように、対合している組を列挙する方法が考
えられます。これは数学では集合として扱うことができます。そして図
\ref{RNA_2d_str_exp}(d)では配列を縦横に並べ、対合している部分に"1"を記入
しています。これも厳密な表現方法であり、コンピュータでも処理しやすいと言
えます。本章ではRNA二次構造に関して図を用いて直感的に解説するときは主に
図\ref{RNA_2d_str_exp}(a)または(b)の表現方法を、RNA二次構造を数学的ある
いはコンピュータで扱うことを考えるとき、図\ref{RNA_2d_str_exp}(c)または
(d)の表現方法を使用することにします。

\section{RNA二次構造の評価}

では最初にRNA二次構造を行う簡単な方法から考えましょう。まず良い二次構造
とは何かを決めなければなりません。そこでまず、ある二次構造に対してスコア
を決めるような枠組みを定義します。このとき、そのスコアが低ければ低いほど、
実際にRNAがそのスコアに対応する構造をとっている可能性が高いようにします。
このようなスコアとして自由エネルギー\footnote{ギブスの自由エネルギー＝エ
ンタルピー−温度×エントロピー。}がよく使われます。厳密な議論はここでは
避けますが、自由エネルギーは状態の安定性を表す指標で、自然界ではこの数値
が小さくなる方向へ状態が自発的に変化します\cite{biophysA}。従って、この数値が小さければ
小さいほどその状態は安定になります。RNA配列中のどの塩基も対合していない
ような状態の自由エネルギーを0とすると、RNAがとりうる二次構造に対応する自
由エネルギーは当然負の数になります。

無数に考えられるRNAの構造１つ１つに対して自由エネルギーを実験的に調べる
のは事実上不可能なので、例えばA-U結合の自由エネルギーは\(-2.0\)、C-G結合の自
由エネルギーは\(-3.0\)のように各部分の塩基対や構造に対して自由エネルギーを定
義し、その総和を構造全体の自由エネルギーとする近似計算がよく行われます。
そこでこの計算法を数学的に以下のように表現します。

まず、RNA分子を\(n\)文字からなる文字列\(R=r_{1}r_{2}r_{3}\cdots 
r_{n}(r_{i}\in {\rm \{A,C,G,U\}})\)と考えます。RNAの二次構造は図
\ref{RNA_2d_str_exp}(c)に既に示したように、\((r_{i},r_{j})\)の対の集合
\(S\)です。ここで\(i\)と\(j\)は\(1\leq i < j\leq n\)を満たします。
\((r_{i},r_{j}) \in S\)なら原則として\(r_{i}\)と\(r_{j}\)はA-U, C-Gなど
の相補的な塩基対でなければなりません\footnote{自然界にはG-Uの弱い結合が存
在する。}。

そしてRNA中のある場所の2つの塩基が対合したときの自由エネルギーは他の場所
の構造に関係ないと仮定します。この仮定はRNAの二次構造予測を容易にする上
で重要です。さてこの仮定のもとでは、構造\(S\)の自由エネルギーの合計\(E\)
は、

\begin{equation}
E(S) = \sum_{(r_{i},r_{j}) \in S} \alpha(r_{i}, r_{j})
\end{equation}

\noindent
となります。ただし、\(\alpha(r_{i}, r_{j})\)は\((r_{i}, r_{j})\)の対合による
自由エネルギーです。

% 便宜上、もし\(i\neq j\) なら、\(\alpha(r_{i}, r_{j}) < 0\),\(i = j\)なら\(\alpha(r_{i}, r_{j}) = 0\)とする。

実際にはRNAはあまりきつく曲がることができないので、ある特定の閾値\(t\) に対
し、\(j-i > t\)でなければなりません。そこでそのような構造に対しては大きな自由エ
ネルギーを割り当てれば、このような構造を回避することができます。

これでRNAの二次構造に対して、自由エネルギーというスコア体系を定義するこ
とができました。

\section{簡単なRNA二次構造予測}
\label{RNA_2d_simple_algo}

RNA二次構造予測法について触れる前に、自然界にある二次構造で対象から外さ
なければならないものがあることをまず説明しておきましょう。それはノット構造で
す\cite{Bioinfo_endo}。ノット構造は\((r_{i},r_{j}) \in S, \quad (r_{k},r_{l}) \in S\)でかつ
\(i<k<j<l\)を満たすときに存在する構造です。このような構造は確かに自然界
に存在し、その一部は重要な機能を持っていますが、これを除外すれば二次構造
予測の問題が簡単になるのです\footnote{ノットがなければ\(S\)は平面グラフに
なる。}。

さていよいよRNAの二次構造予測に対してどのようなアルゴリズムが考えられるか、
考えてゆきましょう。最適な二次構造は最小の自由エネルギーを持つような構造
です。従って、二次構造予測は最小の自由エネルギーをもつ構造を探し出すこと
に帰着します。そこで最も単純なアルゴリズムは、可能な構造を全て列挙し、そ
の中から自由エネルギーが最も低いものを選ぶものです。しかし可能な構造の数
はその塩基数に対して指数関数的に増大するので、長いRNAに対してこのアル
ゴリズムを適用するのは計算時間という意味で実用的ではありません。

\begin{figure}
\includegraphics[scale=0.45]{Figures_EPS/RNA_2d_str_part1.eps}
\caption{部分構造\(S_{i,j}\)の3'末端の塩基\(r_{j}\)が取りうる3つの状態}
\label{RNA_2d_str_part1}
\end{figure}

そこでまず部分配列\(R_{i,j}=r_{i}r_{i+1} \cdots r_{j}\)が取りうる二次構
造\(S_{i,j}\)の中で最小の自由エネルギーを持つものを効率よく探す方法を考
えましょう。ここで\(R_{i,j}\)の3'末端の塩基\(r_{j}\)の状態として考えられ
るのは、図\ref{RNA_2d_str_part1}に示すように、(a)\(r_{i}\)と結合している
か、(b)他の塩基とは結合していないか、(c)\(r_{i}\)以外の塩基と結合してい
るかの３通りです。

\begin{figure}
\includegraphics[scale=0.45]{Figures_EPS/RNA_2d_str_part2.eps}
\caption{RNAの最適な二次構造を求めるための3つの再帰関係}
\label{RNA_2d_str_part2}
\end{figure}

もし\(r_{j}\) が\(r_{i}\)と対合しているとすれば、この結合による自由エネ
ルギーは、\(\alpha(r_{i}, r_{j})\)となります。ここで、RNA中のある場所の2
つの塩基が対合したときの自由エネルギーは他の場所の構造には影響されないと
いう仮定を思い出して下さい。つまり、\(r_{j}\) が\(r_{i}\)と対合している
ときの自由エネルギーはその内側の構造に関係なく常に\(\alpha(r_{i}, 
r_{j})\)で一定です。従って、\(r_{j}\) と\(r_{i}\)が対合している状態で構
造全体の自由エネルギーを最小にするためには、\(S_{i+1,j-1}\)の部分の
エネルギーを最小にすればよいことになります。これを式で書くと、

\begin{equation}
\label{RNA_simp_eq1}
E(S_{i,j}) = \alpha(r_{i}, r_{j}) + E(S_{i+1,j-1})
\end{equation}

\noindent
となります\footnote{厳密には
\({\rm min}_{S_{i,j}}E(S_{i,j})=\alpha(r_{i}, r_{j})+
{\rm min}_{S_{i+1,j-1}}E(S_{i+1,j-1})\)
となるが、本章では簡略化してこのように記述する。
}(図\ref{RNA_2d_str_part2}(a))。

もし\(r_{j}\)の塩基が他の塩基と対合していないとすれば、\(r_{j}\)の塩基は
自由エネルギーの計算には関与しないことになるので、

\begin{equation}
\label{RNA_simp_eq2}
E(S_{i,j})=E(S_{i,j-1})
\end{equation}

\noindent
となります(図\ref{RNA_2d_str_part2}(b))。

最後に\(r_{j}\)が\(i<k<j\) を満たす\(r_{k}\)と対合している状態を考えまし
ょう。この場合、{\bf ノット構造がないという仮定のもとでは}、図
\ref{RNA_2d_str_part2}(c)に示すように、構造を\(S_{i,k-1}\)と\(S_{k,j}\)
の2つの部分に分けて考えることができ、構造全体の自由エネルギーは、
\(S_{i,k-1}\)と\(S_{k,j}\)がそれぞれ持つ自由エネルギーの和になります。こ
こでもRNA中の2つの塩基が対合したときの自由エネルギーは他の場所の構造に関
係なく一定という仮定を使うと、\(S_{i,k-1}\)と\(S_{k,j}\)の構造が持つ自由エネルギー
の計算を独立に行うことが可能なので、構造全体の自由エネルギーを最小にする
ためには、\(S_{i,k-1}\)と\(S_{k,j}\)の両方の自由エネ
ルギーを最小にすれば良いことになります。

しかし\(r_{j}\)がどの塩基と結合するのが適切か分かりませんので、\(i\)と
\(j\)の間の全ての塩基について、\(r_{j}\)が結合した時の最小自由エネルギー
を計算し、その中でも最も低かった自由エネルギーを選ぶことになります。こ
れを式で表すと、

\begin{equation}
\label{RNA_simp_eq3.1}
E(S_{i,j})=\mbox{min}\{E(S_{i,k-1}) + E(S_{k,j})\}\quad {\rm for}\ i<k<j
\end{equation}

\noindent
となります。

\begin{figure}
\includegraphics[scale=0.45]{Figures_EPS/RNA_2d_str_part3_2.eps}
\caption{塩基\(r_{j}\)が結合しない状態の分割による表現}
\label{RNA_2d_str_part3}
\begin{quotation}
(a)では構造\(S_{i,j}\)が\(k-1,k\)の位置で分割されている。
(b)において、\(k=j\)にすることにより、\(r_{j}\)が結合していない状態を
表現できる。
\end{quotation}
\end{figure}

さて実は、図\ref{RNA_2d_str_part2}(b)の\(r_{j}\)がどの塩基にも結合しない
というケースは、(c)の分割で表すことができます。図\ref{RNA_2d_str_part3}
に示すように、構造を\(S_{i,j-1}\)と、\(S_{j,j}\)に分割するのです。この場
合、\(k=j\)です。ここで\(E(S_{j,j})=0\)と定義して式\ref{RNA_simp_eq3.1}
に代入すると、\(k=j\)のときは\(E(S_{i,j})=E(S_{i,j-1}) + 
E(S_{j,j})=E(S_{i,j-1})\)となり式\ref{RNA_simp_eq2}と同じになるので、結
局式\ref{RNA_simp_eq2}と\ref{RNA_simp_eq3.1}を統合して、

\begin{equation}
\label{RNA_simp_eq3.2}
E(S_{i,j})=\mbox{min}\{E(S_{i,k-1}) + E(S_{k,j})\}\quad {\rm for}\ i<k \leq j
\end{equation}

\noindent
とすることができます。但し、\(E(S_{j,j})=0\)です。式\ref{RNA_simp_eq3.1}
と\ref{RNA_simp_eq3.2}の違いは、単に\(k=j\)があるかないかだけです。

結局部分配列\(R_{i,j}\)が取りうる構造の自由エネルギーの中で最小のもの
\(E(S_{ij})\)は、式\ref{RNA_simp_eq1}、
\ref{RNA_simp_eq3.2}で算出される最小自由エネルギーの中で最小のものになる
のでこれら2つの式を統合して

\begin{equation}
E(S_{i,j}) =
  \left\{
     \begin{array}{l}
     0\quad\mbox{if}\qquad i=j\\
     \mbox{min}\left\{
        \begin{array}{l}
        E(S_{i+1,j-1}) + \alpha(r_{i},r_{j})\\
        \mbox{min}\{E(S_{i,k-1}) + E(S_{k,j})\} \mbox{ただし} i < k \le j\\
        \end{array}
     \right.
     \end{array}
  \right.
\label{eq8.2}
\end{equation}

\noindent
となります。与えられた配列全体の最小の自由エネルギーは\(E(S_{1,n})\)となります。
式\ref{eq8.2}を関数ESとして実装すれば以下のようになるでしょう
(演習問題\ref{rna_prac1})。

\noindent
\underline{\hspace{10cm}}

\begin{verbatim}
/* グローバル配列変数r[]の中に塩基配列を入れておく */
/* alpha(char a, char b)は塩基a,bが対合したときの
   自由エネルギーを返す関数 */

double ES(int i, int j){

　/* 変数の宣言などをここに書く */

\end{verbatim}
  /* 式\ref{eq8.2}の最初の式 */
\begin{verbatim}
  if(i >= j)min = 0.0;
  else {
\end{verbatim}
  /* 式\ref{eq8.2}のminの中の最初の式 */
\begin{verbatim}
    con = ES(i + 1, j - 1) + alpha(r[i], r[j]);
    disj_min = 99999;
\end{verbatim}
  /* 式\ref{eq8.2}のminの中の２番目の式 */
\begin{verbatim}
    for(k = i + 1;k <= j;k ++){
         disj = ES(i, k - 1) + ES(k, j);
         if(disj_min > disj){
                disj_min = disj;
                disj_min_k = k;
         }
    }
    if(con < disj_min)min = con;
    else min = disj_min;
  }
  return min;
}
\end{verbatim}

\noindent
\underline{\hspace{10cm}}

\section{計算の重複の回避}
\label{RNA_2d_dp}

\(1 \leq i < j \leq n\)に対して、\(E(S_{i,j})\)は決まった値を持つはずで
す。従って一度ある\(E(S_{i,j})\)を計算してしまえば、同じ\(E(S_{i,j})\)を
２度以上計算する必要はありません。しかし式\ref{eq8.2}をそのまま使うと、
同じ部分に対して複数回計算が行われてしまいます。実際部分構造\(S_{s,t}\)
が計算されるのは、部分構造\(S_{s,u}\)が\(S_{s,t},S_{t+1,u}\)に分割された
ときや、\(S_{s,v}\)が、\(S_{s,t},S_{t+1,v}\)に分割されるときなど沢山のケ
ースがあります。そこで、一度計算した\(E(S_{i,j})\)の値を例えば\(n \times 
n\)の行列\(E\)に記録し\footnote{実際に値を入れるのは行列の右上半分だけ、
つまり\(i < j\)のところだけで済む。}、二度目から\(E\)に保存した値を使っ
て再帰が起こらないようにすると、計算速度を飛躍的に向上させることができま
す。

また別法として、\(E(S_{i,j})\)を求める際にどの部分構造の最小自由エネルギ
ーがあらかじめ分かっていなくてはならないかを考慮し、再帰を使わずに効率よ
く\(E(S_{i,j})\)を求めることも可能です。

基本的には\ref{recur_fast}で学習した方法と一緒ですので、復習の上、演
習問題\ref{rna_prac2}, \ref{rna_prac_bu}に挑戦してみて下さい。

\begin{table}
\includegraphics[scale=0.45]{Figures_EPS/RNA_2d_str_mat_E.eps}
\caption{\(E(S_{i,j})\)を記録する行列\(E\)}
\label{RNA_2d_str_mat_E}
\begin{quotation}
配列"gttataacac"を対象とし、A-Uの対合は-2、C-Gの対合は-3とした。
また、RNAはいくらでもきつく曲がることができるとした。
\end{quotation}
\end{table}

表\ref{RNA_2d_str_mat_E}に"gttataacac"を二次構造予測にかけ、行列\(E\)に
値を記録していった結果を示します。A-Uの対合は-2、C-Gの対合は-3とし、RNA
はいくらでもきつく曲がることができるとしました。


\section{二次構造の決定}
\label{RNA_2d_DtoC}

これまで与えられたRNAの一次配列に対して最小の自由エネルギーを求める方法
を考えてきました。ここからは、最小の自由エネルギーに対応する構造を求める
方法について考えてゆきましょう(演習問題\ref{rna_prac3})。

最小自由エネルギーを求める過程で、塩基同士をどのように結合させていったか、
またRNAの構造をどの位置で分割していったかをまず記録してゆきます。より具
体的には\(n \times n\)の行列\(D\)を用意し、構造\(S_{i,j}\)の最小自由エネ
ルギー\(E(S_{i,j})\)は

\begin{enumerate}
\item \(r_{i},r_{j}\)を結合させたときに得られたか
\item 構造\(S_{i,j}\)を\(k\)の位置で分割したときに得られたか
\end{enumerate}

\noindent
を\(D_{i,j}\)(\(D\)の\(i\)行目、\(j\)列目)に記録してゆきます。例えば、部
分構造\(S_{i,j}\)の最小自由エネルギーが両端の塩基を結合させたときに得ら
れた場合、\(D_{i,j}\)に"XX"を記録します。また最小自由エ
ネルギーが構造を\(S_{i,k-1}\)と\(S_{k,j}\)に分割したときに得られた場合、
\(D_{i,j}\)に\(k\)を記録します
\footnote{分割の場合、\(i < D_{i,j} \leq j\)となるので、結
合のときは\(D_{i,j}\)に\(i\)を入れても分割と結合を区別できる。コンピュー
タは数値データの方が扱いやすいため、この記録方法が効果的(演習問題
\ref{rna_prac3})。}。

\begin{table}
\includegraphics[scale=0.45]{Figures_EPS/RNA_2d_str_mat_D.eps}
\caption{構造\(S_{i,j}\)の最小自由エネルギーが求まったときに行った操作
(最適な位置での構造の分割または両端塩基の結合(XX))を記録する行列\(D\)}
\label{RNA_2d_str_mat_D}
\end{table}

表\ref{RNA_2d_str_mat_D}に先ほどの配列の最小自由エネルギーを求める過程で
記録に使用した行列\(D\)の中味を示します。行列の1行目10列目を見ると、全体
の構造\(S_{1,10}\)の自由エネルギーが最小になるのは、構造を\(S_{1,8}\)と
\(S_{9,10}\)に分割したときであることが分かります。

次に行列\(D\)から二次構造を表す行列\(C\)を計算します。行列\(C\)が表現す
る意味は、図\ref{RNA_2d_str_exp}(d)と同じです。まず、RNA全体の最小自由エ
ネルギー\(E(S_{1,n})\)が求まったときに、どのような操作をしたかを
\(D_{1,n}\)より得ます。\(D_{1,n}=\)"XX"、つまり\(r_{1}\)と\(r_{n}\)を結
合させていれば、\(C_{1,n}=1\)として、次にその１つ内側の構造\(S_{2,n-1}\)
を調べます。\(D_{1,n}\)に数値\(k\)が入っていれば、構造を\(k-1,k\)の位置
で分割したということなので、次に構造\(S_{1,k-1}\)と\(S_{k,n}\)を調べてゆ
きます。

例えば表\ref{RNA_2d_str_mat_D}より全体の構造\(C\)を計算するためには、ま
ず\(D_{1,10}\)を見ます。値が9なので構造を\(S_{1,8}\)と\(S_{9,10}\)に分割
し、次に\(D_{1,8}\)と\(D_{9,10}\)を調べます。後者の方は次に\(S_{9,9}\)と
\(S_{10,10}\)に分割されてしまい、1塩基ずつになってしまうのでそこで処理が
終わりです。前者の方は\(D_{1,8}\)が"XX"になっているので、\(C_{1,8}=1\)と
することによって\(r_{1}\)と\(r_{8}\)の塩基を結合させます。そしてその内側
の構造\(S_{2,7}\)の\(D_{2,7}\)を調べます。

\(D\)から\(C\)を求める正確なアルゴリズムは以下の通りです。
これをプログラムとして実装してみましょう(演習問題\ref{rna_prac3})。

\noindent
\underline{\hspace{10cm}}\\
DtoC(\(i, j\)):行列\(Ｄ\)を参照し、RNA配列の一部\((i,j)\)の二次構造\(C\)を求める
\begin{enumerate}
\item \(i \geq j\)なら処理なし
\item そうでなければ、\(D_{i,j}=\)XXなら、\(C_{i,j}\)を1にして、DtoC(\(i + 1, j - 1\))を呼ぶ（塩基の結合）
\item そうでなければ、DtoC\((i, D_{i,j} - 1)\)を呼んだ後、DtoC\((D_{i,j}, j)\)を呼ぶ(構造の分割)
\end{enumerate}
\noindent
\underline{\hspace{10cm}}

\begin{table}
\includegraphics[scale=0.45]{Figures_EPS/RNA_2d_str_mat_C.eps}
\caption{二次構造を表す行列\(C\)}
\label{RNA_2d_str_mat_C}
\begin{quotation}
表の左下にこの行列が表しているRNAの二次構造を示した。
\end{quotation}
\end{table}

表\ref{RNA_2d_str_mat_D}の\(D\)をもとに求めた\(C\)を表
\ref{RNA_2d_str_mat_C}に示します。

\section{Zuker法}


これまでは各塩基対に対して自由エネルギーを決め、構造内の塩基対の自由エネ
ルギーの総和が構造全体の自由エネルギーであるという非常に単純な自由エネル
ギー計算を行っていました。しかしこの計算法はRNA構造の自由エネルギーの
近似計算を行う上で必ずしも十分とは言えません。そこで多くの二次構造予測で
はより複雑な近似を行っています。この節ではZuker法\cite{zuker}で使われて
いる近似計算をまず紹介しましょう。


\begin{figure}
\begin{center}
\includegraphics[scale=0.45]{Figures_EPS/RNA_2d_face.eps}
\end{center}
\caption{RNA二次構造の閉領域}
\label{RNA_2d_face}
\end{figure}

Zuker法では閉領域(face)と呼ばれる単位で自由エネルギーの計算が行われます。
閉領域とは図\ref{RNA_2d_face}で考えると、塩基配列をつなぐ線（共有結合を
表す）と、塩基間の対合を表す線（水素結合を表す）で囲まれた領域のことです。
厳密に言えば、閉領域は以下のように定義されます。

\begin{enumerate}
\item \label{RNA_face1} \(i,u,v,j\)\((i<u<v<j)\)が閉領域であるとは、
\((i,j) \in S\)かつ\((u,v) \in S\)であり、\(i<s<u,v<t<j\)を満たす全ての
\(s,t\)に対して、\((s,t) \notin S\)が成立するときである
\footnote{\(i<s<u,v<t<j\)を満たす\(s,t\)がないときは、\((i,j) \in S\)か
つ\((u,v) \in S\)が成立すれば、 \(i,u,v,j\)が閉領域であると見なされる。
この場合この閉領域はステム構造またはバルジ構造となる。}。
このとき閉領域の大きさは、\((u-i-1, j-v-1)\)である。
\item \label{RNA_face2} \((i,j)\)が閉領域であるとは、\(i<s<t<j\)を満たす全
ての全ての\(s,t\)に対して、\((s,t) \notin S\)が成立するときである。
このとき閉領域の大きさは、\(j-i-1\)である。
\end{enumerate}

\begin{figure}
\includegraphics[scale=0.6]{Figures_EPS/RNA_2d_bstr.eps}
\caption{RNAの二次構造の部分構造の分類}
\label{fig8.1}
\begin{small}
\begin{quotation}
灰色の印は塩基を表し、横の二重線は塩基対を表す。(a)ステム構造、
(b)バルジ構造、(c)内部ループ、(d)ヘアピン構造。
\end{quotation}
\end{small}
\end{figure}

閉領域は図\ref{fig8.1}に示すように、その形状によっていくつかに分類されます。
\ref{RNA_face1}で定義される閉領域のうち、大きさが(0,0)のものをステム構造、
大きさが\((0,p)\)または\((p,0)\)で、\(p>0\)のものをバルジ構造、大きさが
\((p,q)\)で、\(p > 0, q > 0\)のものを内部ループと呼びます。また
\ref{RNA_face2}で定義される閉領域をヘアピン構造と呼びます。

\begin{table}
\includegraphics[scale=0.45]{Figures_EPS/RNA_2d_FE_param.eps}
\caption{RNAの部分構造に対する自由エネルギー\cite{biotech_computer}(kcal/mol)}
\label{RNA_2d_FE_param}
\begin{quotation}
"ステム構造"の表では、一番左の列に5'側の塩基対を、一番上の行に3'側の
塩基対を示し、対応する自由エネルギーを記入した。他の表の一番左の列(10の
位)と一番上の列(1の位)に閉領域の大きさを示し、対応する自由エネルギーを記入
した。
\end{quotation}
\end{table}

ステム構造はRNAの構造を安定化するので、負の自由エネルギーが与えられます。
逆に、バルジ構造、内部ループ、ヘアピン構造はRNAの構造を不安定にするもの
と考えられ、正の自由エネルギーが与えられます。閉領域がその形状に応じてど
れくらいの自由エネルギーを持つかは生化学的な実験で調べられています(表
\ref{RNA_2d_FE_param})。

\begin{figure}
\includegraphics[scale=0.45]{Figures_EPS/RNA_fe_calc.eps}
\caption{Zuker法における自由エネルギーの計算}
\label{RNA_fe_calc}
\end{figure}

Zuker法ではRNA全体の自由エネルギーは、全ての閉領域の自由エネルギーの和であ
ると定義します。例えば図\ref{RNA_fe_calc}のような二次構造に対しては、各
部分の自由エネルギーを表\ref{RNA_2d_FE_param}で計算し、それを全て合計して
\(-5.3\) kcal/molとなります。そして最適な構造\(S_{1,n}\)は、このように定義さ
れたRNA全体の自由エネルギーが最小の値\(E(S_{1,n})\)になるものです。これ
をどのように求めればよいかを考えてゆきましょう。

まず\(S_{1,n}\)の部分構造\(S_{i,j}\)の最小自由エネルギー\(E(S_{i,j})\)の
求め方から考えましょう。5'端側の塩基\(r_{i}\) が対合していないと仮定しま
す。すると、\(E(S_{i,j})=E(S_{i+1,j})\)となります。次に3'端側の塩基
\(r_{j}\)が対合していないと仮定します。すると同様に
\(E(S_{i,j})=E(S_{i,j-1})\) となります。そして\(r_{i}\)と\(r_{j}\)が互い
にでなく、別の塩基と対合していると仮定します。すると
\(E(S_{i,j})=\mbox{min}\{E(S_{i,k-1}) +E(S_{k,j})\}\)(ただし、\(i+1<k<j\))
となります。最後に\((r_{i},r_{j})\)が対合する場合が考えられます。
\((r_{i},r_{j})\)が対合するような構造を\(L_{i,j}\)とすれば、結局

\begin{equation}
E(S_{i,j})= \mbox{min}\left\{
   \begin{array}{l}
      E(S_{i+1,j})\\
      E(S_{i,j-1})\\
      E(L_{i,j})\\
      \mbox{min}\{E(S_{i,k-1})+E(S_{k,j})\} \quad \mbox{for}\quad i+1 < k < j
   \end{array}\right.
\label{zuker1}
\end{equation}

\noindent
という再帰式を立てることができます。さて\(E(L_{i,j})\)について詳しく考え
ましょう。\((r_{i},r_{j})\)が対合している場合、それは図\ref{fig8.1}に示
すような構造の一部であるか、図\ref{RNA_2d_str_bifur}に示すような分岐構造
の一部になっているはずです。図\ref{fig8.1}に示すような構造であれば、これ
は先に定義した閉領域に該当し、その部分の自由エネルギーが一意に決まります。
そこで図\ref{RNA_2d_str_Zuker1}に示すように、ヘアピンの自由エネルギーを
\(\xi(j-i-1)\)とし、それ以外のヘアピン、ステム構造、内部ループ、バルジ構
造の自由エネルギーを\(e(i,j,u,v,R)\)で表しましょう。ステム構造のときは、
塩基配列\(R\)の中の塩基\(r_{i},r_{j},r_{u},r_{v}\)が自由エネルギーに関係
しますが、内部ループやバルジ構造の場合は閉領域の大きさである
\((u-i-1,j-v-1)\)のみが自由エネルギーに関係します。

\begin{figure}
\includegraphics[scale=0.6]{Figures_EPS/RNA_2d_str_Zuker1.eps}
\caption{閉領域の自由エネルギーとそれを求める関数\(e\)}
\label{RNA_2d_str_Zuker1}
\begin{quotation}
各閉領域のタイプと、その閉領域の自由エネルギーを関数\(\xi\)および\(e\)を使って示した。
\end{quotation}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[scale=0.6]{Figures_EPS/RNA_2d_str_Zuker2.eps}
\end{center}
\caption{構造\(L_{i,j}\)の末端がステム構造または内部ループ、バルジ構造になると
きの最小自由エネルギーを求める再帰式}
\label{RNA_2d_str_Zuker2}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[scale=0.5]{Figures_EPS/RNA_2d_str_bifur.eps}
\end{center}
\caption{構造\(L_{i,j}\)の末端が分岐構造の一部になるときの最小自由エネル
ギーを求める再帰式}
\label{RNA_2d_str_bifur}
\end{figure}


\(L_{i,j}\)がそのままヘアピン構造となる場合は、
\(E(L_{i,j})=\xi(j-i-1)\)となります。ステム構造か、内部ループ、バルジ構造になる場合
は、図\ref{RNA_2d_str_Zuker2}に示すように、
\(E(L_{i,j})=e(i,j,u,v,R)+E(L_{k_{1},k_{2}})\)となります。そして分
岐構造の一部であれば、図\ref{RNA_2d_str_bifur}に示すように、
\(E(L_{i,j})=E(S_{i+1,k-1})+E(S_{k,j-1})\)(但し、\(i+2<k<j-1\))となります。ここで分岐構造自体の
自由エネルギーは0とします。以上の関係をまとめると、

\begin{equation}
E(L_{i,j})= \mbox{min}\left\{
   \begin{array}{l}
      \xi(j - i - 1)\\
      \mbox{min}\{e(i,j,k_{1},k_{2},R) + E(L_{k_{1}, k_{2}})\}\\
      \quad \quad \quad \quad \quad \quad \quad \quad \quad  \mbox{for}\quad i < k_{1} < k_{2} < j \\
      \mbox{min}\{E(S_{i+1,k-1})+E(S_{k,j-1})\}\\
      \quad \quad \quad \quad \quad \quad \quad \quad \quad \mbox{for}\quad i+2<k<j-1
   \end{array}\right.
\label{zuker2}
\end{equation}

\vspace{1em}

\noindent
となります。
但し\(e(i,j,k_{1},k_{2},R)\)は\(r_{i}\)と\(r_{i}\)、\(r_{k_{1}}\)と
\(r_{k_{2}}\)がそれぞれ結合したときの自由エネルギーを表します。バルジル
ープ、内部ループ、ヘリカル領域の自由エネルギーが全て関数\(e\)で表現されて
います。

\begin{practice}
\item \label{rna_prac1} \(E(S_{i,j})\)の値を求める関数をプログラムとして実装しましょう。
\item \label{rna_prac2} 演習問題\ref{rna_prac1}のプログラムを改良し、
\(E(S_{i,j})\)の値を\(n \times n\)行列\verb+e_matrix[][]+に逐次入れて、
随時参照することにより、高速化しましょう。
\item \label{rna_prac_bu} 再帰を使わずに\(E(S_{i,j})\)を求める関数を実装しましょう。
\item \label{rna_prac3} 最小の自由エネルギーに対応する二次構造を求めるプ
ログラムを作成しましょう。本文中の行列\(D\)に該当する二次元配列
\verb+d_matrix[][]+と\(C\)に該当する二次元配列\verb+c_matrix[][]+を用意
し、節\ref{RNA_2d_DtoC}で解説した関数DtoCを参考に、
\verb+d_matrix[][]+から
\verb+c_matrix[][]+を再帰的に求める関数\verb+d_to_c+を作ると効率良く
構造を求めることができるでしょう。
なお、\verb+d_matrix[i][j]+が
k(i\(<\)k\(\le\)j)のときは、構造がk-1とkのところで分割されたことを示し、
\verb+d_matrix[i][j]+がiのときは、iとjが結合したことを示すようにするとよ
いでしょう。
\item \label{rna_prac4} 節\ref{RNA_2d_simple_algo}で取り扱った簡単なRNA
二次構造の予測方法では、分割を表現する式\ref{RNA_simp_eq3.2}で両端の塩基
が結合していない状態を取り扱うことができました。Zuker法では、
\(E(S_{i,j})=E(S_{i+1,j}),E(S_{i,j})=E(S_{i,j-1})\)のように、両端の塩基
が結合していない状態を明確に表現する必要があります。何故でしょうか？
\end{practice}

