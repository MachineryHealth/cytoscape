#! /usr/bin/env python

import sys, os
myBinDir = os.path.normpath(os.path.dirname(sys.argv[0]))
sys.path.append(myBinDir + "/../src")

from illumina.vcfTools import VarTable

def main():

    vartbl = VarTable(sys.argv[2])

    f = file(sys.argv[1], 'r')
    fdata = f.readlines()
    f.close()

    for line in fdata[1:]:
        row = line.strip().split("\t")
        chrom = row[1]
        if chrom.startswith("CHR"):
            chrom = "chr" + chrom[3:]
        pos = row[2]
        ref = row[4]
        alt = row[5]
        var = vartbl.getVarInfo(chrom, pos, ref, alt)
        afs = var.estimateAF()
        if afs != []:
            afs = ",".join(map(str(afs)))
        row.append(afs)
        print "\t".join(row)
        

if __name__ == "__main__":
	main()
