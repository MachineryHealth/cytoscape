#! /usr/bin/env python

import sys, os
myBinDir = os.path.normpath(os.path.dirname(sys.argv[0]))
sys.path.append(myBinDir + "/../src")

from illumina.vcfTools import VarTable

def main():

    vartbl = VarTable(sys.argv[2])

    f = file(sys.argv[1], 'r')
    fdata = f.readlines()
    f.close()

    #Index	source	gene	chrom	start	end	type	ref	alt
    for line in fdata[1:]:
        row = line.strip().split("\t")
        #Germline
        #chrom = row[1]
        #if chrom.startswith("CHR"):
        #    chrom = "chr" + chrom[3:]
        #pos = row[2]
        #ref = row[4]
        #alt = row[5]
        chrom = row[3]
        if chrom.startswith("CHR"):
            chrom = "chr" + chrom[3:]
        pos = row[5]
        ref = row[7]
        alt = row[8]
        qual = vartbl.getQuality(chrom, pos, ref, alt)
        filter = vartbl.getFilter(chrom, pos, ref, alt)
        if qual == None:
            qual = ""
        if filter == None:
            filter = ""
        row.append(qual)
        if filter == "PASS":
            print "\t".join(row)
        else:
            sys.stderr.write("nopass\n")

if __name__ == "__main__":
	main()
